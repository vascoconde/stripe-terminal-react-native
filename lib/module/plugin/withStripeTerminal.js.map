{"version":3,"names":["pkg","require","withStripeTerminal","config","props","withStripeTerminalIos","withNoopSwiftFile","withStripeTerminalAndroid","expoConfig","modResults","addBTPermissionToManifest","addLocationPermissionToManifest","androidManifest","Array","isArray","manifest","find","item","$","push","bluetoothBackgroundMode","UIBackgroundModes","NSLocationWhenInUseUsageDescription","locationWhenInUsePermission","NSBluetoothPeripheralUsageDescription","bluetoothPeripheralPermission","NSBluetoothAlwaysUsageDescription","bluetoothAlwaysUsagePermission","IOSConfig","XcodeProjectFile","withBuildSourceFile","filePath","contents","join","name","version"],"sources":["withStripeTerminal.ts"],"sourcesContent":["import {\n  ConfigPlugin,\n  createRunOncePlugin,\n  IOSConfig,\n  withInfoPlist,\n  withAndroidManifest,\n  AndroidConfig,\n} from '@expo/config-plugins';\n\ntype InnerManifest = AndroidConfig.Manifest.AndroidManifest['manifest'];\n\ntype ManifestPermission = InnerManifest['permission'];\n\ntype AndroidManifest = {\n  manifest: InnerManifest & {\n    'permission'?: ManifestPermission;\n    'uses-permission'?: InnerManifest['uses-permission'];\n    'uses-feature'?: InnerManifest['uses-feature'];\n  };\n};\n\nconst pkg = require('@stripe/stripe-terminal-react-native/package.json');\n\ntype StripeTerminalPluginProps = {\n  bluetoothBackgroundMode?: boolean;\n  locationWhenInUsePermission?: string;\n  bluetoothPeripheralPermission?: string;\n  bluetoothAlwaysUsagePermission?: string;\n};\n\nconst withStripeTerminal: ConfigPlugin<StripeTerminalPluginProps> = (\n  config,\n  props\n) => {\n  config = withStripeTerminalIos(config, props);\n  config = withNoopSwiftFile(config);\n  config = withStripeTerminalAndroid(config);\n\n  return config;\n};\n\nconst withStripeTerminalAndroid: ConfigPlugin = (expoConfig) => {\n  return withAndroidManifest(expoConfig, (config) => {\n    config.modResults = addBTPermissionToManifest(config.modResults);\n    config.modResults = addLocationPermissionToManifest(config.modResults);\n\n    return config;\n  });\n};\n\nexport function addLocationPermissionToManifest(\n  androidManifest: AndroidManifest\n) {\n  if (!Array.isArray(androidManifest.manifest['uses-permission'])) {\n    androidManifest.manifest['uses-permission'] = [];\n  }\n\n  if (\n    !androidManifest.manifest['uses-permission'].find(\n      (item) =>\n        item.$['android:name'] === 'android.permission.ACCESS_FINE_LOCATION'\n    )\n  ) {\n    androidManifest.manifest['uses-permission']?.push({\n      $: {\n        'android:name': 'android.permission.ACCESS_FINE_LOCATION',\n      },\n    });\n  }\n\n  if (\n    !androidManifest.manifest['uses-permission'].find(\n      (item) =>\n        item.$['android:name'] === 'android.permission.ACCESS_COARSE_LOCATION'\n    )\n  ) {\n    androidManifest.manifest['uses-permission']?.push({\n      $: {\n        'android:name': 'android.permission.ACCESS_COARSE_LOCATION',\n      },\n    });\n  }\n  return androidManifest;\n}\n\nexport function addBTPermissionToManifest(androidManifest: AndroidManifest) {\n  // Add `<uses-permission android:name=\"android.permission.BLUETOOTH_CONNECT/SCAN\"/>` to the AndroidManifest.xml\n  if (!Array.isArray(androidManifest.manifest['uses-permission'])) {\n    androidManifest.manifest['uses-permission'] = [];\n  }\n\n  if (\n    !androidManifest.manifest['uses-permission'].find(\n      (item) =>\n        item.$['android:name'] === 'android.permission.BLUETOOTH_CONNECT'\n    )\n  ) {\n    androidManifest.manifest['uses-permission']?.push({\n      $: {\n        'android:name': 'android.permission.BLUETOOTH_CONNECT',\n      },\n    });\n  }\n\n  if (\n    !androidManifest.manifest['uses-permission'].find(\n      (item) => item.$['android:name'] === 'android.permission.BLUETOOTH_SCAN'\n    )\n  ) {\n    androidManifest.manifest['uses-permission']?.push({\n      $: {\n        'android:name': 'android.permission.BLUETOOTH_SCAN',\n      },\n    });\n  }\n  return androidManifest;\n}\n\n/**\n * Grant bluetooth and location permissions.\n */\nconst withStripeTerminalIos: ConfigPlugin<StripeTerminalPluginProps> = (\n  expoConfig,\n  props\n) => {\n  return withInfoPlist(expoConfig, (config) => {\n    if (props.bluetoothBackgroundMode) {\n      config.modResults.UIBackgroundModes = ['bluetooth-central'];\n    }\n\n    config.modResults.NSLocationWhenInUseUsageDescription =\n      props.locationWhenInUsePermission ||\n      'Location access is required in order to accept payments.';\n\n    config.modResults.NSBluetoothPeripheralUsageDescription =\n      props.bluetoothPeripheralPermission ||\n      'Bluetooth access is required in order to connect to supported bluetooth card readers.';\n\n    config.modResults.NSBluetoothAlwaysUsageDescription =\n      props.bluetoothAlwaysUsagePermission ||\n      'This app uses Bluetooth to connect to supported card readers.';\n    return config;\n  });\n};\n\n/**\n * Add a blank Swift file to the Xcode project for Swift compatibility.\n */\nexport const withNoopSwiftFile: ConfigPlugin = (config) => {\n  return IOSConfig.XcodeProjectFile.withBuildSourceFile(config, {\n    filePath: 'noop-file.swift',\n    contents: [\n      '//',\n      '// @generated',\n      '// A blank Swift file must be created for native modules with Swift files to work correctly.',\n      '//',\n      '',\n    ].join('\\n'),\n  });\n};\n\nexport default createRunOncePlugin(withStripeTerminal, pkg.name, pkg.version);\n"],"mappings":"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"}